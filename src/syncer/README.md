# Syncer 모듈

`syncer` 모듈은 프로젝트 환경(Target)의 변경사항을 원본 소스(Source)로 역전파(Back-propagation)하는 엔진을 담당합니다.

## 주요 역할

1. **상태 비교 (Diff)**: 타겟 결과물과 원본 소스 사이의 메타데이터(`description`), 본문(`content`), 추가 파일(`extras`)의 차이점을 감지합니다.
2. **부분적 업데이트 (Partial Update)**: 원본 마크다운 파일의 구조(주석, 들여쓰기 등)를 보존하면서 특정 필드만 교체합니다.
3. **디렉터리 동기화**: 스킬 디렉터리 내의 추가 파일들을 해시 기반으로 비교하여 추가, 삭제, 수정을 수행합니다.

## 주요 구성 요소

### 1. Syncer (`mod.rs`)
전체 동기화 프로세스를 조율하는 실행기입니다.
- **`exclude_patterns` 관리**: 생성 시 패턴 목록을 주입받아 소속된 모든 싱커들이 일관된 필터링 규칙을 따르도록 제어합니다.
- **`sync_resource`**: 단일 리소스에 대해 역변환(Detransform)을 수행하고 소스에 반영합니다.

### 2. MdPatcher (`patcher.rs`)
마크다운 파일의 구조와 포맷을 보존하면서 특정 부분만 수정합니다.
- **정규표현식 기반 패치**: YAML 파싱 대신 라인 단위 교체를 통해 주석이나 필드 순서를 유지합니다.
- **안전 검사**: 멀티라인 데이터 등 복잡한 구조가 감지되면 원본 파손 방지를 위해 작업을 중단합니다.

### 3. ExtraSyncer (`extra.rs`)
두 디렉터리 간의 파일을 비교하여 `SyncAction`을 생성하고 실행합니다.
- **해시 기반 비교**: SHA-256 해시를 비교하여 변경 여부를 판단합니다.
- **필터링**: `core::FileFilter`를 활용하여 동기화 대상 파일을 선별합니다.

## 동기화 흐름

1. `app::App::sync`에서 `Syncer` 인스턴스를 생성(패턴 주입)합니다.
2. 리소스 목록을 순회하며 `Syncer::sync_resource`를 호출합니다.
3. 타겟 파일을 읽어 `Transformer::detransform`으로 모델 데이터를 복원합니다.
4. `MdPatcher`로 소스 마크다운을 업데이트하고, `ExtraSyncer`로 스킬 추가 파일들을 동기화합니다.

## 설계 원칙
- **원본 보존 (Preservation)**: 소스 파일의 주석이나 포맷을 최대한 유지하기 위해 전체 파일을 다시 쓰지 않고 부분적 패치를 우선합니다.
- **무결성 (Integrity)**: 해시 비교를 통해 불필요한 파일 쓰기를 방지하고, 모호한 변경 사항에 대해서는 실패(Fail-fast)를 선택합니다.
