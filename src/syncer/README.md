# Syncer 모듈

`syncer` 모듈은 타겟 에이전트 환경의 변경사항을 원본 소스로 동기화하는 핵심 엔진을 담당합니다.

## 주요 역할

1. **상태 비교 (Diff)**: 타겟 결과물과 원본 소스 사이의 메타데이터(`description`), 본문(`content`), 추가 파일(`extras`)의 차이점을 감지합니다.
2. **수술적 업데이트 (Surgical Update)**: 원본 마크다운 파일의 포맷(주석, 들여쓰기 등)을 최대한 유지하면서 특정 필드만 교체합니다.
3. **디렉터리 동기화**: 스킬 디렉터리 내의 파일 추가, 삭제, 수정을 해시 기반으로 정합성을 맞춘 계획을 수립하고 실행합니다.

## 주요 구성 요소

### 1. SyncExecutor (`mod.rs`)
전체 동기화 프로세스를 제어하는 오케스트레이터입니다.
- `run()`: 설정 로드, 레지스트리 구축 후 `syncer::sync::Syncer`를 생성하여 모든 리소스에 대해 동기화를 수행합니다.

### 2. Syncer (`sync.rs`)
개별 리소스의 실제 동기화 로직을 수행하는 실행기입니다.
- `sync()`: 단일 리소스에 대해 역변환(Detransform)을 수행하고 변경사항을 소스 파일에 반영합니다.

### 3. Diff 모듈 (`src/syncer/diff/`)
물리적인 변경 감지, 계획 수립 및 정교한 파일 수정 로직을 포함합니다.
- **`MarkdownPatcher`**: 정규표현식을 사용해 마크다운 Frontmatter 내의 필드나 본문 영역만 수술적으로 교체합니다.
- **`SyncPlanner`**: 원본과 타겟 디렉터리를 비교하여 추가, 수정, 삭제, 패치가 필요한 액션 목록을 생성합니다.
- **`SkillSyncer`**: Planner의 계획을 바탕으로 실제 파일 시스템 작업을 수행하는 동기화 조율기입니다.

## 동기화 흐름

1. **컨텍스트 준비**: `SyncExecutor`가 `agb.yaml`을 로드하고 소스 레지스트리를 구축합니다.
2. **동기화기 생성**: 빌드 타겟에 맞는 `Transformer`와 실행 시점의 설정을 가진 `Syncer` 객체를 생성합니다.
3. **역변환 및 비교**: `Syncer::sync` 과정에서 `Transformer::detransform`을 통해 타겟 파일을 모델로 복원하고 소스와 비교합니다.
4. **계획 및 반영**: `diff` 모듈을 통해 변경이 감지된 필드(Description, Content)를 업데이트하거나, 스킬 디렉터리의 전체 정합성을 맞춥니다.

## 상세 문서
- [**Diff 모듈 상세**](./diff/README.md): Patcher, Planner, Syncer의 상세 설계 및 동작 방식
